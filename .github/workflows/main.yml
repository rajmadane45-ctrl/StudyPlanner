name: Build Android APK

on:
  push:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Install system dependencies
  run: |
    sudo apt update
    sudo apt install -y \
      python3 python3-pip git zip unzip \
      openjdk-17-jdk \
      libgl1-mesa-dev \
      libgles2-mesa-dev \
      build-essential \
      ccache \
      autoconf \
      libtool \
      pkg-config \
      android-sdk \
      sdkmanager

    - - name: Setup Android SDK licenses
  run: |
    yes | sdkmanager --licenses || true

- name: Build APK
  run: |
    buildozer init
    sed -i 's/main.py/study_planner.py/' buildozer.spec
    buildozer -v android debug

    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: StudyPlanner-APK
        path: bin/*.apk
